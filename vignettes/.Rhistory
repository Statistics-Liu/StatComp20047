str(women)
pairs(women)
trials<-replicate(
100,
t.test(rpois(10,10),rpois(7,10)),
simplify = FALSE
)
set.seed(10000)
sapply(trials,function(x) x$p.value)
#using [[ instead of anonymous function
sapply(trials,"[[",3)
apply<-function(data,f,output_type){
tmp<-Map(f,data)
vapply(tmp,function(x) x ,output_type)
}
apply(USArrests,mean,double(1))
#for loops
for (i in 1:length(formulas)) {
model<-lm(formulas[[i]],mtcars)
print(model)
}
formulas<-list(
mpg~disp,
mpg~I(1/disp),
mpg~disp+wt,
mpg~I(1/disp)+wt
)
#for loops
for (i in 1:length(formulas)) {
model<-lm(formulas[[i]],mtcars)
print(model)
}
#lapply()
lapply(formulas, function(x) lm(data=mtcars,x))
EM.trend<-function(p.ini,n.Observations){
M=1e5
tol=.Machine$double.eps
n=sum(n.Observations)
nA.=n.Observations[1]
nB.=n.Observations[2]
nOO=n.Observations[3]
nAB=n.Observations[4]
p=q=r=numeric(0)
loglikelihood=numeric(0)
p[1]=p.ini[1]
q[1]=p.ini[2]
r[1]=1-p[1]-q[1]
loglikelihood[1]=0
times=1
for(i in 2:M){
p.before=p[i-1]
q.before=q[i-1]
r.before=r[i-1]
nAA.t=nA.*p.before^2/(p.before^2+2*p.before*r.before)
nAO.t=nA.*2*p.before*r.before/(p.before^2+2*p.before*r.before)
nBB.t=nB.*q.before^2/(q.before^2+2*q.before*r.before)
nBO.t=nB.*2*q.before*r.before/(q.before^2+2*q.before*r.before)
nOO.t=nOO
nAB.t=nAB
p[i]=(2*nAA.t+nAO.t+nAB.t)/2/n
q[i]=(2*nBB.t+nBO.t+nAB.t)/2/n
r[i]=(2*nOO.t+nAO.t+nBO.t)/2/n
times=times+1
loglikelihood[i]=nAA.t*2*log(p[i])+nAO.t*log(2*p[i]*r[i])+nBB.t*2*log(q[i])+nBO.t*log(q[i]*r[i])+nOO.t*2*log(r[i])+nAB.t*log(2*p[i]*q[i])
U=abs((p[i]-p.before)/p.before)<=tol
V=abs((q[i]-q.before)/q.before)<=tol
W=abs((r[i]-r.before)/r.before)<=tol
if(U&&V&&W)
break
}
list(TIMEs=times,p.MLE_EM=p[times],q.MLE_EM=q[times],r.MLE_EM=r[times],
p.MLE.all=p,q.MLE.all=q,loglikelihoods=loglikelihood)
}
nObs=c(444,132,361,63)
pInitial=c(0.3,0.3)
em.result<-EM.trend(p.ini=pInitial,n.Observations=nObs)
par(mfrow=c(1,2))
plot(em.result$p.MLE.all,xlab = "TIMEs",ylab = "p.MLE",ylim = c(0,0.4))
lines(em.result$p.MLE.all,col='blue')
plot(em.result$q.MLE.all,xlab = "TIMEs",ylab = "q.MLE",ylim=c(0,0.4))
lines(em.result$q.MLE.all,col='blue')
k<-c(4:25,100,500,1000)
root<-numeric()
for (i in 1:length(k)) {
res <- uniroot(function(a){
pt(sqrt(a^2*(k[i]-1)/(k[i]-a^2)),df=k[i]-1,
log.p = T)-pt(sqrt(a^2*(k[i])/(k[i]+1-a^2)),df=k[i],log.p = T)
},lower = 1e-5,upper = sqrt(k[i]-1e-5))
root[i]<-unlist(res)[[1]]
}
root
